<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Crypto Timeline â€“ Binance + RSS (No Keys)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
<style>
  :root{--h:560px;--ui:#0ea5e9;--bg:#eef2f3;--card:#fff;--muted:#6b7280;--line:#cbd5e1;--good:#10b981;--bad:#ef4444;--bull:#e9f8ef;--bear:#ffe9ea}
  *{box-sizing:border-box} body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,system-ui,sans-serif;background:var(--bg);color:#111827}
  header{position:sticky;top:0;z-index:30;display:flex;justify-content:space-between;align-items:center;gap:10px;padding:10px 14px;background:rgba(255,255,255,.9);border-bottom:1px solid #e5e7eb;backdrop-filter:saturate(1.05) blur(6px)}
  .left,.right{display:flex;gap:10px;align-items:center}.brand{font-weight:800}
  .search input{width:260px;padding:10px 12px;border:1px solid #d1d5db;border-radius:12px}
  .btn{padding:10px 12px;border:1px solid #d1d5db;border-radius:12px;background:#fff;cursor:pointer}.btn.primary{background:var(--ui);border-color:var(--ui);color:#fff}
  .pill{padding:7px 10px;border:1px solid #d1d5db;border-radius:10px;background:#fff;cursor:pointer}.pill.active{background:var(--ui);border-color:var(--ui);color:#fff}
  .theme{width:20px;height:20px;border-radius:50%;border:2px solid #e5e7eb;cursor:pointer}.theme.active{outline:2px solid var(--ui)}
  .blue{background:#0ea5e9}.green{background:#22c55e}.purple{background:#a855f7}
  .dm{width:36px;height:36px;border-radius:999px;border:1px solid #d1d5db;background:#fff;display:grid;place-items:center;cursor:pointer}
  .topbar{position:absolute;left:0;right:0;bottom:-2px;height:3px;background:#e5e7eb}.prog{width:0%;height:100%;background:linear-gradient(90deg,var(--ui),#3b82f6);transition:width .25s ease}
  .grid{display:grid;grid-template-columns:360px 1fr 240px;gap:16px;padding:16px}
  .card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 1px 8px rgba(0,0,0,.05)} .inner{padding:16px}
  .muted{color:var(--muted);font-size:12px}.kpi{display:flex;justify-content:space-between;padding:6px 0}.good{color:var(--good)}.bad{color:var(--bad)}
  .summary{background:#f9fafb;border:1px dashed #e5e7eb;border-radius:12px;padding:10px;font-size:13px;color:#374151}
  .tl{position:relative;overflow:hidden;height:var(--h)} .split{position:absolute;inset:0;display:grid;grid-template-rows:1fr 1fr}
  .up{background:var(--bull)} .down{background:var(--bear)} .center{position:absolute;left:0;right:0;height:2px;background:var(--line)}
  .sent{position:absolute;right:12px;text-align:center}.sent .v{font-size:34px;font-weight:800}
  .sent.b{top:10px}.sent.r{bottom:10px}.sent.b .v{color:var(--good)}.sent.r .v{color:var(--bad)}
  .layer{position:absolute;inset:0;pointer-events:none}
  .col{position:absolute;top:0;bottom:0;transform:translateX(-50%)} .vline{position:absolute;width:2px;background:var(--line)}
  .date{position:absolute;transform:translate(-50%,-50%);top:0;left:50%;padding:3px 6px;border:1px solid #e5e7eb;background:var(--card);border-radius:6px;font-size:10px;color:#374151}
  .bubble{position:absolute;left:50%;transform:translate(-50%,0);border-radius:999px;color:#fff;display:grid;place-items:center;box-shadow:0 10px 22px rgba(0,0,0,.18);pointer-events:auto;overflow:hidden;transition:transform .2s ease}
  .bubble:hover{transform:translate(-50%,0) scale(1.06)} .bull{background:linear-gradient(145deg,#16a34a,#065f46)} .bear{background:linear-gradient(145deg,#ef4444,#991b1b)} .neu{background:linear-gradient(145deg,#9ca3af,#6b7280)}
  .bubble img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:.25;filter:grayscale(15%)} .btxt{position:relative;font-size:11px;font-weight:800;text-shadow:0 1px 3px rgba(0,0,0,.35)}
  .top3{outline:3px solid gold;outline-offset:2px}
  .tip{position:absolute;z-index:30;background:var(--card);color:#111827;border:1px solid #e5e7eb;border-radius:10px;padding:8px 10px;box-shadow:0 8px 24px rgba(0,0,0,.15);width:280px;font-size:12px;display:none}
  .tip .src{color:#64748b;font-size:11px;margin-top:4px}
  .overlay{position:fixed;inset:0;background:rgba(255,255,255,.85);backdrop-filter:blur(3px);display:none;align-items:center;justify-content:center;flex-direction:column;gap:10px;z-index:50}
  .bar{width:360px;height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden}.bar>div{width:0%;height:100%;background:linear-gradient(90deg,var(--ui),#3b82f6);transition:width .25s ease}
  @media (prefers-color-scheme: dark){
    body{background:#0b0e13;color:#e5e7eb} header{background:rgba(12,14,19,.82);border-bottom-color:#1f2937}
    .search input,.btn,.pill,.dm{background:#0f131a;border-color:#273244;color:#e5e7eb}
    .card{background:#0f131a;border-color:#1f2937} .summary{background:#0b0e13;border-color:#1f2937;color:#cbd5e1}
    .center,.vline{background:#334155}.date{background:#0f131a;border-color:#273244;color:#cbd5e1}
    .up{background:#0c2016}.down{background:#2a0d12}.tip{background:#0f131a;border-color:#273244;color:#e5e7eb}
    .overlay{background:rgba(8,10,14,.72)}
  }
</style>
</head>
<body>
<header>
  <div class="left">
    <div class="brand">ðŸ“Š Crypto Timeline</div>
    <div class="search">
      <input id="q" placeholder="Search coin (e.g., bitcoin, ethereum, solana)" />
      <button class="btn primary" id="go">Load</button>
    </div>
    <div id="rng">
      <button class="pill active" data-d="7">1W</button>
      <button class="pill" data-d="30">1M</button>
      <button class="pill" data-d="90">3M</button>
    </div>
  </div>
  <div class="right">
    <div class="theme blue active" data-t="blue" title="Blue"></div>
    <div class="theme green" data-t="green" title="Green"></div>
    <div class="theme purple" data-t="purple" title="Purple"></div>
    <button class="dm" id="dm" title="Dark mode">ðŸŒ™</button>
    <div class="topbar"><div id="top" class="prog"></div></div>
  </div>
</header>

<div class="grid">
  <div class="card"><div class="inner">
    <div id="title" style="font-weight:800;font-size:18px;margin-bottom:6px">Bitcoin (BTC)</div>
    <div class="muted" style="margin-bottom:10px">Price: Binance â€¢ News: CoinDesk/CoinTelegraph/Decrypt/Reuters via AllOrigins</div>
    <div id="stats">Loadingâ€¦</div>
    <div style="height:8px"></div>
    <div class="summary" id="sum">Summary will appearâ€¦</div>
    <div style="height:10px"></div>
    <div class="summary" id="top3">Top 3 headlinesâ€¦</div>
  </div></div>

  <div class="card tl" id="tl">
    <div class="split"><div class="up"></div><div class="down"></div></div>
    <canvas id="c"></canvas>
    <div class="center" id="mid"></div>
    <div class="layer" id="layer"></div>
    <div class="sent b"><div class="v" id="bp">0%</div><div class="muted">Bullish</div></div>
    <div class="sent r"><div class="v" id="rp">0%</div><div class="muted">Bearish</div></div>
    <div class="tip" id="tip"></div>
  </div>

  <div class="card"><div class="inner">
    <div style="font-weight:700">Tips</div>
    <div class="muted" style="margin-top:6px">Click a bubble to open article. Hover shows source & date.</div>
    <div class="muted" style="margin-top:10px" id="page">â€”</div>
  </div></div>
</div>

<div class="overlay" id="ov">
  <div class="bar"><div id="ovb"></div></div>
  <div class="muted" id="ovt">Loadingâ€¦</div>
</div>

<script>
(()=> {
  // ========= THEME =========
  const root=document.documentElement, topBar=document.getElementById('top');
  const themes=document.querySelectorAll('.theme');
  function setTheme(t){ themes.forEach(d=>d.classList.toggle('active',d.dataset.t===t));
    const map={blue:'#0ea5e9',green:'#22c55e',purple:'#a855f7'}; root.style.setProperty('--ui',map[t]||'#0ea5e9'); localStorage.setItem('ct_theme',t);}
  setTheme(localStorage.getItem('ct_theme')||'blue');
  themes.forEach(d=>d.onclick=()=>setTheme(d.dataset.t));

  document.getElementById('dm').onclick=()=>{ document.body.classList.toggle('force-dark'); };

  // ========= ELEMENTS =========
  const q=document.getElementById('q'), go=document.getElementById('go'), rng=document.getElementById('rng');
  const title=document.getElementById('title'), stats=document.getElementById('stats'), sum=document.getElementById('sum'), top3=document.getElementById('top3');
  const tl=document.getElementById('tl'), layer=document.getElementById('layer'), mid=document.getElementById('mid');
  const bp=document.getElementById('bp'), rp=document.getElementById('rp'), page=document.getElementById('page');
  const tip=document.getElementById('tip');
  const ov=document.getElementById('ov'), ovb=document.getElementById('ovb'), ovt=document.getElementById('ovt');

  // ========= STATE =========
  let days=30, coin='bitcoin', symbol='BTC', name='Bitcoin', chart, series=[]; // Binance uses symbols, but for news we use name/symbol
  const feeds=[
    'https://www.coindesk.com/arc/outboundfeeds/rss/?outputType=xml',
    'https://cointelegraph.com/rss',
    'https://decrypt.co/feed',
    'https://feeds.reuters.com/reuters/technologyNews'
  ];

  // ========= HELPERS =========
  const fmt=v=> v==null?'â€”': v>1e12?(v/1e12).toFixed(2)+'T': v>1e9?(v/1e9).toFixed(2)+'B': v>1e6?(v/1e6).toFixed(2)+'M': (Math.round(v*100)/100).toLocaleString();
  const setTop=p=> topBar.style.width=p+'%';
  const showOv=(t)=>{ ov.style.display='flex'; ovt.textContent=t||'Loadingâ€¦'; ovb.style.width='0%'; };
  const ovStep=(p,t)=>{ ovb.style.width=p+'%'; if(t) ovt.textContent=t; };
  const hideOv=()=> ov.style.display='none';
  const allorigins=u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`;
  function parseRSS(xml){
    const items=[]; const re=/<item>([\s\S]*?)<\/item>/gi; let m;
    const ex=(b,t)=>{const r=new RegExp(`<${t}[^>]*>([\\s\\S]*?)<\\/${t}>`,'i');const mm=r.exec(b);return mm? mm[1].replace(/<!\\[CDATA\\[(.*?)\\]\\]>/g,'$1').trim():'';}
    while((m=re.exec(xml))){const b=m[1];const title=ex(b,'title'),link=ex(b,'link'),pub=ex(b,'pubDate');if(title&&link){const domain=link.includes('http')?new URL(link).hostname.replace('www.',''):'';items.push({title,link,domain,ts:pub?Date.parse(pub):Date.now()});}}
    return items;
  }
  function sent(txt){ const t=txt.toLowerCase(); const pos=['surge','record','approve','partnership','adopt','rally','up','bull','funding','launch','growth','wins','support','integration','buy','adds','builds','expands']; const neg=['hack','ban','fall','plunge','lawsuit','probe','halt','outage','exploit','scam','bear','crash','dump','delay','bug','vulnerability','charges']; let s=0; pos.forEach(k=>t.includes(k)&&(s+=1)); neg.forEach(k=>t.includes(k)&&(s-=1)); return s; }
  function rel(item){ const age=(Date.now()-item.ts)/86400000; const rec=Math.max(0,1-age/days); const se=Math.min(1,Math.abs(item.sent)/3); const src=/coindesk|cointelegraph|decrypt|reuters/.test(item.domain)?1:0.7; return 0.5*rec+0.35*se+0.15*src; }
  const fav=d=>`https://www.google.com/s2/favicons?domain=${encodeURIComponent(d)}&sz=64`;

  // ========= DATA LOADERS =========
  async function loadPrice(){
    setTop(10);
    // Binance klines (no key, CORS open). Use BTCUSDT 1d
    const interval='1d', limit=Math.max(30,days+2);
    const url=`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${interval}&limit=${limit}`;
    const r=await fetch(url); const data=await r.json(); // each item: [openTime,open,high,low,close,...]
    const kl=data.slice(-days-1); // keep range
    series=kl.map(k=>({t:k[0], y:parseFloat(k[4])}));
    const ctx=document.getElementById('c').getContext('2d');
    if(chart) chart.destroy();
    chart=new Chart(ctx,{type:'line',data:{datasets:[{data:series,parsing:{xAxisKey:'t',yAxisKey:'y'},borderColor:'#0f172a',borderWidth:2,pointRadius:0,tension:.25}]},
      options:{responsive:true,maintainAspectRatio:false,scales:{x:{type:'time',time:{unit:days<=7?'day':'week'},grid:{display:false}},y:{grid:{color:'rgba(148,163,184,.25)'}}},plugins:{legend:{display:false},tooltip:{enabled:false}}}
    );
    const first=series[0]?.y,last=series.at(-1)?.y,chg=first?((last-first)/first)*100:0;
    stats.innerHTML=`<div class="kpi"><span>Price</span><strong>$${fmt(last)}</strong></div>
    <div class="kpi"><span>Change (${days===7?'1W':days===30?'1M':'3M'})</span><strong class="${chg>=0?'good':'bad'}">${chg.toFixed(2)}%</strong></div>`;
    setTop(30);
    return {first,last,chg};
  }

  async function loadNews(){
    setTop(45);
    // fetch all feeds via AllOrigins
    const resps = await Promise.allSettled(feeds.map(u=>fetch(allorigins(u)).then(r=>r.text())));
    let items=[]; resps.forEach(x=>{ if(x.status==='fulfilled'){ items=items.concat(parseRSS(x.value)); }});
    // filter for coin keywords
    const kw = [name.toLowerCase(), symbol.toLowerCase(), coin.toLowerCase()];
    items = items.filter(it=> kw.some(k=> it.title.toLowerCase().includes(k)));
    // enrich
    items = items.map(it=> ({...it, sent: sent(it.title), rel:0, cons:0}));
    items.forEach(it=> it.rel = rel(it));
    items.forEach(it=> it.cons = Math.max(.2, Math.min(1, 0.45*Math.min(1,Math.abs(it.sent)/3) + 0.55* (/coindesk|cointelegraph|decrypt|reuters/.test(it.domain)?0.8:0.5))));
    // only last N days
    const start=Date.now()-days*86400000;
    items = items.filter(it=> it.ts >= start);
    // sort and cap
    items.sort((a,b)=> b.rel - a.rel);
    const pageItems = items.slice(0,20);
    setTop(70);
    return pageItems;
  }

  // ========= RENDER =========
  function pxFor(ms){ return chart.scales.x.getPixelForValue(ms); }
  function placeBubbles(items,kpi){
    layer.innerHTML='';
    // percentages
    const bulls=items.filter(i=>i.sent>0).length, bears=items.filter(i=>i.sent<0).length, total=bulls+bears||1;
    bp.textContent=Math.round(bulls/total*100)+'%'; rp.textContent=Math.round(bears/total*100)+'%';
    // center shift
    const h=tl.clientHeight; const shift=((bears-bulls)/total)*60; const cy=h/2+shift; mid.style.top=cy+'px';
    // top3
    const top3items=[...items].sort((a,b)=>b.rel-a.rel).slice(0,3);
    top3.innerHTML='<strong>Top 3 impactful</strong><ol style="margin:6px 0 0 18px;padding:0">'+top3items.map(n=>`<li><a href="${n.link}" target="_blank" rel="noopener">${n.title}</a> <span class="muted">(${n.domain})</span></li>`).join('')+'</ol>';
    // summary
    sum.innerHTML=`<div><strong>${name}</strong> moved <strong class="${kpi.chg>=0?'good':'bad'}">${kpi.chg.toFixed(2)}%</strong> over the last <strong>${days===7?'1W':days===30?'1M':'3M'}</strong>.</div>
    <div>News mix: <strong>${bulls}</strong> bullish / <strong>${bears}</strong> bearish.</div><div class="muted">Size=relevance â€¢ distance=consensus â€¢ position=bull/bear.</div>`;
    // bubbles
    const tip=document.getElementById('tip');
    items.sort((a,b)=>a.ts-b.ts).forEach(n=>{
      const x = pxFor(n.ts);
      const dist = 30 + n.cons*170;
      const y = n.sent>0? cy - dist : n.sent<0? cy + dist : cy;
      const size = 22 + Math.min(1,Math.max(0,n.rel))*48;

      const col=document.createElement('div'); col.className='col'; col.style.left=x+'px';
      const v=document.createElement('div'); v.className='vline'; v.style.top=Math.min(cy,y)+'px'; v.style.height=Math.abs(cy-y)+'px'; v.style.left='50%'; v.style.transform='translateX(-50%)';
      const tag=document.createElement('div'); tag.className='date'; tag.style.top=cy+'px'; tag.textContent=new Date(n.ts).toLocaleDateString();

      const b=document.createElement('div'); b.className='bubble '+(n.sent>0?'bull':n.sent<0?'bear':'neu')+(top3items.includes(n)?' top3':'');
      b.style.width=size+'px'; b.style.height=size+'px'; b.style.top=(y-size/2)+'px'; b.title=n.title; b.onclick=()=>window.open(n.link,'_blank','noopener');
      const img=document.createElement('img'); img.src=fav(n.domain); img.alt=''; b.appendChild(img);
      const t=document.createElement('div'); t.className='btxt'; t.textContent=Math.round(50+n.rel*50); b.appendChild(t);
      b.addEventListener('mouseenter',e=>{ tip.style.display='block'; tip.style.left=(e.pageX+12)+'px'; tip.style.top=(e.pageY-10)+'px'; tip.innerHTML=`<strong>${n.title}</strong><div class="src">${n.domain} â€¢ ${new Date(n.ts).toLocaleString()}</div>`;});
      b.addEventListener('mouseleave',()=> tip.style.display='none');

      col.appendChild(v); col.appendChild(tag); col.appendChild(b); layer.appendChild(col);
    });
    page.textContent=`Showing ${items.length} items`;
  }

  // ========= PIPELINE =========
  async function loadAll(){
    try{
      setTop(2);
      const kpi = await loadPrice();
      const items = await loadNews();
      setTop(90);
      placeBubbles(items,kpi);
      setTop(100);
    }catch(e){ console.error(e); setTop(100); }
  }

  // ========= EVENTS =========
  rng.addEventListener('click',e=>{
    const b=e.target.closest('.pill'); if(!b)return;
    rng.querySelectorAll('.pill').forEach(x=>x.classList.remove('active')); b.classList.add('active');
    days=parseInt(b.dataset.d,10); showOv('Loading rangeâ€¦'); ovStep(20);
    loadAll().then(()=>{ ovStep(100,'Done'); setTimeout(hideOv,400); });
  });
  go.onclick=async ()=>{
    const v=(q.value||'').trim().toLowerCase(); if(!v) return;
    // map common names -> Binance symbol for chart (USDT pairs)
    const map={bitcoin:'BTC',btc:'BTC',ethereum:'ETH',eth:'ETH',solana:'SOL',sol:'SOL',ripple:'XRP',xrp:'XRP',cardano:'ADA',ada:'ADA',litecoin:'LTC',ltc:'LTC'};
    const sym=map[v]||'BTC';
    name = (v.length<=4? (sym==='BTC'?'Bitcoin':sym) : v[0].toUpperCase()+v.slice(1));
    symbol = sym; coin = v;
    title.textContent = `${name} (${symbol})`;
    showOv('Loading coinâ€¦'); ovStep(15,'Priceâ€¦');
    await loadPrice(); ovStep(60,'Newsâ€¦');
    const items=await loadNews(); ovStep(85,'Renderingâ€¦');
    placeBubbles(items,{first:series[0]?.y,last:series.at(-1)?.y,chg:((series.at(-1)?.y-series[0]?.y)/series[0]?.y*100)||0});
    ovStep(100,'Done'); setTimeout(hideOv,400);
  };

  // ========= INIT =========
  loadAll();
})();
</script>
</body>
</html>